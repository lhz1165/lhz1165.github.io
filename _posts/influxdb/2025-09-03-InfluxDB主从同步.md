---
layout: post
title: "Influx主从同步原理"
category: InfluxDB
---

LSM主从同步

# Influx主从同步原理

InfluxDB (1.x)  底层存储结构是TSM (**Time-Structured Merge Tree** ),   实现思想来自于LSM（**Log-Structured Merge-Tree**），学习 InfluxDB 可以先前置了解 **LSM**

## **LSM-tree基础**

索引结构更新可以选择两种策略

- **就地更新**:  在原数据页（page/block）上直接修改已有的数据内容  ；Mysql的 **B+树**

- 每次修改只操作小部分页，成本较低
- 插入删除，造成的页分裂只影响部分页，只需局部更新
- 持久化是随机写，适合读多写少的场景

-  **延迟批量更新**:   即更新时先复制一份新页面缓存，再修改，然后用新页面替换旧页面；  **LSM-Tree** （ 先顺序写入 WAL 和 MemTable，最后再合并到 SSTable（类似 COW  ） 

- 插入还是删除，都会以一个新的记录追加到日志文件
-  多个小的有序文件会合并，磁盘占用小
- 顺序写入，适合写多的场景

因此对于大量写入的数据库例如InfluxDB选择“**延迟批量更新**”性能更好。