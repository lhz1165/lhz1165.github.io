---
layout: post
title: "xv6-mmap"
category: os-6s081-source
---

6.s081 xv6-mmap

## Mmap知识点

过程

1. 当用户调用 `mmap` 时，会向**内核发出系统调用,进入内核态**。
2. 内核根据参数（如文件描述符、偏移量、权限等），为当前进程分配一段未使用的**虚拟地址**（没有映射到任何物理页）。
3. 内核只是建立了一个 `vm_area_struct`，登记了这个虚拟地址和文件偏移的映射关系：
4. 访问这个虚拟地址触发缺页异常
   1. 查找 Page Cache，从磁盘读取文件
   2. 把内容放入 Page Cache，并分配一个物理页
5. 用户态的虚拟地址对应的页表添加一个页表项 新的虚拟地址指向新分配的物理页

最终，用户空间拿到的是**用户空间的虚拟地址**，这段地址在访问时仍然会触发页表机制，由 MMU（内存管理单元）完成虚拟地址到物理地址的转换。
